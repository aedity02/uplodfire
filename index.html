<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudVault - Premium Storage Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK (Modular v10) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            updateProfile 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc, 
            collection, 
            query, 
            where, 
            orderBy, 
            addDoc, 
            deleteDoc,
            onSnapshot,
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCBYzY1vWjKM21cOyReSSeDCs9lh1xUtbw",
            authDomain: "storage-bot-624f6.firebaseapp.com",
            projectId: "storage-bot-624f6",
            storageBucket: "storage-bot-624f6.firebasestorage.app",
            messagingSenderId: "825474586592",
            appId: "1:825474586592:web:9b77861ee94fbf1e707d85",
            measurementId: "G-V68SLRRHRZ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ============================================
        // BACKEND CONFIGURATION
        // ============================================
        // IMPORTANT: Deploy the Node.js backend separately and update this URL
        const BACKEND_URL = "https://your-backend-url.onrender.com"; // Change this to your deployed backend URL

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        let currentUser = null;
        let userProfile = null;
        let userFiles = [];
        let userFolders = [];
        let userActivities = [];
        let selectedFiles = [];
        let analyticsChart = null;
        let filesUnsubscribe = null;
        let foldersUnsubscribe = null;
        let activitiesUnsubscribe = null;

        // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
        
        /**
         * Handle user sign up with Firebase Auth
         * Creates user in Auth and stores profile in Firestore
         */
        async function handleSignUp(e) {
            e.preventDefault();
            
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const errorEl = document.getElementById('signupError');
            const btn = document.getElementById('signupBtn');

            // Validation
            if (!name || !email || !password) {
                showAuthError(errorEl, 'Please fill in all fields');
                return;
            }

            if (password.length < 6) {
                showAuthError(errorEl, 'Password must be at least 6 characters');
                return;
            }

            // UI Loading State
            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner" style="width: 20px; height: 20px;"></div> Creating account...';

            try {
                // Create user in Firebase Auth
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Update profile with display name
                await updateProfile(user, { displayName: name });

                // Create user document in Firestore
                await setDoc(doc(db, "users", user.uid), {
                    name: name,
                    email: email.toLowerCase(),
                    createdAt: serverTimestamp(),
                    plan: "FREE"
                });

                // Create default folders
                const defaultFolders = ['Documents', 'Images', 'Projects'];
                for (const folderName of defaultFolders) {
                    await addDoc(collection(db, "users", user.uid, "folders"), {
                        name: folderName,
                        createdAt: serverTimestamp()
                    });
                }

                showToast('Account created successfully!', 'success');
                // Auth state listener will handle redirect
            } catch (error) {
                console.error('Signup error:', error);
                let message = 'An error occurred. Please try again.';
                
                switch(error.code) {
                    case 'auth/email-already-in-use':
                        message = 'Email already registered. Please sign in.';
                        break;
                    case 'auth/invalid-email':
                        message = 'Invalid email address.';
                        break;
                    case 'auth/weak-password':
                        message = 'Password is too weak.';
                        break;
                }
                
                showAuthError(errorEl, message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span data-feather="user-plus"></span> Create Account';
                feather.replace();
            }
        }

        /**
         * Handle user login with Firebase Auth
         */
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');
            const btn = document.getElementById('loginBtn');

            if (!email || !password) {
                showAuthError(errorEl, 'Please fill in all fields');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<div class="loading-spinner" style="width: 20px; height: 20px;"></div> Signing in...';

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showToast('Welcome back!', 'success');
                // Auth state listener will handle redirect
            } catch (error) {
                console.error('Login error:', error);
                let message = 'Invalid email or password.';
                
                if (error.code === 'auth/user-not-found') {
                    message = 'No account found with this email.';
                } else if (error.code === 'auth/wrong-password') {
                    message = 'Incorrect password.';
                } else if (error.code === 'auth/too-many-requests') {
                    message = 'Too many attempts. Please try again later.';
                }
                
                showAuthError(errorEl, message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span data-feather="log-in"></span> Sign In';
                feather.replace();
            }
        }

        /**
         * Handle user logout
         */
        async function handleLogout() {
            try {
                await signOut(auth);
                // Clear local state
                currentUser = null;
                userProfile = null;
                userFiles = [];
                userFolders = [];
                userActivities = [];
                
                // Unsubscribe from Firestore listeners
                if (filesUnsubscribe) filesUnsubscribe();
                if (foldersUnsubscribe) foldersUnsubscribe();
                if (activitiesUnsubscribe) activitiesUnsubscribe();
                
                showToast('Logged out successfully', 'success');
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Error logging out', 'error');
            }
        }

        /**
         * Monitor auth state changes
         * Handles session persistence and redirects
         */
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User is signed in
                currentUser = user;
                
                // Load user profile from Firestore
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    userProfile = userDoc.data();
                } else {
                    // Fallback if profile missing
                    userProfile = {
                        name: user.displayName || 'User',
                        email: user.email,
                        plan: 'FREE'
                    };
                }
                
                // Setup real-time listeners
                setupFirestoreListeners();
                
                // Show dashboard
                showDashboard();
            } else {
                // User is signed out
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('authPage').classList.add('active');
                document.getElementById('dashboardPage').classList.remove('active');
            }
        });

        // ============================================
        // FIRESTORE REAL-TIME LISTENERS
        // ============================================
        
        /**
         * Setup real-time listeners for user data
         * Updates UI automatically when data changes
         */
        function setupFirestoreListeners() {
            if (!currentUser) return;

            // Listen for files
            const filesQuery = query(
                collection(db, "users", currentUser.uid, "files"),
                orderBy("uploadedAt", "desc")
            );
            
            filesUnsubscribe = onSnapshot(filesQuery, (snapshot) => {
                userFiles = [];
                snapshot.forEach((doc) => {
                    userFiles.push({ id: doc.id, ...doc.data() });
                });
                updateUI();
            }, (error) => {
                console.error('Files listener error:', error);
            });

            // Listen for folders
            const foldersQuery = query(
                collection(db, "users", currentUser.uid, "folders"),
                orderBy("createdAt", "desc")
            );
            
            foldersUnsubscribe = onSnapshot(foldersQuery, (snapshot) => {
                userFolders = [];
                snapshot.forEach((doc) => {
                    userFolders.push({ id: doc.id, ...doc.data() });
                });
                updateFolderSelects();
                updateFoldersGrid();
            }, (error) => {
                console.error('Folders listener error:', error);
            });

            // Listen for activities
            const activitiesQuery = query(
                collection(db, "users", currentUser.uid, "activities"),
                orderBy("timestamp", "desc"),
                // Limit to last 100 for performance
            );
            
            activitiesUnsubscribe = onSnapshot(activitiesQuery, (snapshot) => {
                userActivities = [];
                snapshot.forEach((doc) => {
                    userActivities.push({ id: doc.id, ...doc.data() });
                });
                updateActivityList();
            }, (error) => {
                console.error('Activities listener error:', error);
            });
        }

        // ============================================
        // FILE OPERATIONS
        // ============================================
        
        /**
         * Upload files through secure backend
         * Files stream to Telegram via backend, metadata saved to Firestore
         */
        async function uploadFiles() {
            if (selectedFiles.length === 0) {
                showToast('Please select files to upload', 'warning');
                return;
            }

            // Check file sizes (2GB max)
            const MAX_SIZE = 2 * 1024 * 1024 * 1024; // 2GB
            for (const file of selectedFiles) {
                if (file.size > MAX_SIZE) {
                    showToast(`File "${file.name}" exceeds 2GB limit`, 'error');
                    return;
                }
            }

            const folder = document.getElementById('uploadFolder').value;
            const progressOverlay = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('uploadProgressBar');
            const progressPercent = document.getElementById('uploadProgressPercent');
            const progressName = document.getElementById('uploadFileName');

            closeModal('uploadModal');
            progressOverlay.classList.add('active');

            let successCount = 0;

            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                progressName.textContent = `Uploading ${file.name}... (${i + 1}/${selectedFiles.length})`;
                
                const progress = ((i + 0.5) / selectedFiles.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressPercent.textContent = `${Math.round(progress)}%`;

                try {
                    // Get Firebase ID token for authentication
                    const idToken = await currentUser.getIdToken();
                    
                    // Create form data
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('folder', folder || '');
                    formData.append('userId', currentUser.uid);
                    formData.append('fileName', file.name);

                    // Upload to backend
                    const response = await fetch(`${BACKEND_URL}/upload`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${idToken}`
                        },
                        body: formData
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.message || 'Upload failed');
                    }

                    const result = await response.json();

                    // Save metadata to Firestore
                    await addDoc(collection(db, "users", currentUser.uid, "files"), {
                        name: file.name,
                        size: file.size,
                        type: file.type || 'application/octet-stream',
                        folder: folder || null,
                        uploadedAt: serverTimestamp(),
                        telegramFileId: result.fileId,
                        telegramMessageId: result.messageId,
                        mimeType: file.type || 'application/octet-stream'
                    });

                    // Log activity
                    await addDoc(collection(db, "users", currentUser.uid, "activities"), {
                        action: 'Uploaded file',
                        details: file.name,
                        timestamp: serverTimestamp()
                    });

                    successCount++;
                } catch (error) {
                    console.error('Upload error:', error);
                    showToast(`Failed to upload ${file.name}: ${error.message}`, 'error');
                }

                const finalProgress = ((i + 1) / selectedFiles.length) * 100;
                progressBar.style.width = `${finalProgress}%`;
                progressPercent.textContent = `${Math.round(finalProgress)}%`;
            }

            progressOverlay.classList.remove('active');
            selectedFiles = [];
            document.getElementById('selectedFiles').innerHTML = '';
            document.getElementById('fileInput').value = '';

            if (successCount > 0) {
                showToast(`${successCount} file(s) uploaded successfully!`, 'success');
            }
        }

        /**
         * Download file using Telegram file_id via backend
         */
        async function downloadFile(fileId) {
            const file = userFiles.find(f => f.id === fileId);
            if (!file || !file.telegramFileId) {
                showToast('File not found', 'error');
                return;
            }

            showToast('Preparing download...', 'info');

            try {
                const idToken = await currentUser.getIdToken();
                
                // Request download URL from backend
                const response = await fetch(`${BACKEND_URL}/download/${file.telegramFileId}`, {
                    headers: {
                        'Authorization': `Bearer ${idToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to get download URL');
                }

                const result = await response.json();
                
                // Open download in new tab
                if (result.downloadUrl) {
                    window.open(result.downloadUrl, '_blank');
                    
                    // Log activity
                    await addDoc(collection(db, "users", currentUser.uid, "activities"), {
                        action: 'Downloaded file',
                        details: file.name,
                        timestamp: serverTimestamp()
                    });
                    
                    showToast('Download started!', 'success');
                }
            } catch (error) {
                console.error('Download error:', error);
                showToast('Failed to download file', 'error');
            }
        }

        /**
         * Delete file metadata from Firestore
         * Note: File remains in Telegram (storage is free)
         */
        async function deleteFile(fileId) {
            const file = userFiles.find(f => f.id === fileId);
            if (!file) return;

            if (!confirm(`Delete "${file.name}"?`)) return;

            try {
                await deleteDoc(doc(db, "users", currentUser.uid, "files", fileId));
                
                // Log activity
                await addDoc(collection(db, "users", currentUser.uid, "activities"), {
                    action: 'Deleted file',
                    details: file.name,
                    timestamp: serverTimestamp()
                });
                
                showToast('File deleted', 'success');
            } catch (error) {
                console.error('Delete error:', error);
                showToast('Failed to delete file', 'error');
            }
        }

        // ============================================
        // FOLDER OPERATIONS
        // ============================================
        
        /**
         * Create new folder in Firestore
         */
        async function createFolder(e) {
            e.preventDefault();
            
            const name = document.getElementById('folderName').value.trim();
            if (!name) {
                showToast('Please enter a folder name', 'warning');
                return;
            }

            // Check for duplicates
            if (userFolders.some(f => f.name === name)) {
                showToast('Folder already exists', 'error');
                return;
            }

            try {
                await addDoc(collection(db, "users", currentUser.uid, "folders"), {
                    name: name,
                    createdAt: serverTimestamp()
                });

                // Log activity
                await addDoc(collection(db, "users", currentUser.uid, "activities"), {
                    action: 'Created folder',
                    details: name,
                    timestamp: serverTimestamp()
                });

                closeModal('folderModal');
                document.getElementById('folderName').value = '';
                showToast('Folder created!', 'success');
            } catch (error) {
                console.error('Create folder error:', error);
                showToast('Failed to create folder', 'error');
            }
        }

        // ============================================
        // UI UPDATES (Preserved from original)
        // ============================================
        
        function updateUI() {
            updateUserInfo();
            updateStorageDisplay();
            updateRecentUploads();
            updateAllFiles();
            updateFoldersGrid();
            updateFolderSelects();
            updateActivityList();
            updateStats();
            updateSecurityPage();
            feather.replace();
        }

        function updateUserInfo() {
            if (!currentUser || !userProfile) return;

            const name = userProfile.name || currentUser.displayName || 'User';
            const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
            
            document.getElementById('userAvatar').textContent = initials;
            document.getElementById('userName').textContent = name;
            document.getElementById('welcomeName').textContent = name.split(' ')[0];

            // Settings page
            const settingsName = document.getElementById('settingsName');
            const settingsEmail = document.getElementById('settingsEmail');
            if (settingsName) settingsName.value = name;
            if (settingsEmail) settingsEmail.value = currentUser.email || '';

            // Update greeting based on time
            const hour = new Date().getHours();
            let greeting = 'morning';
            if (hour >= 12 && hour < 17) greeting = 'afternoon';
            else if (hour >= 17) greeting = 'evening';
            document.getElementById('greeting').textContent = greeting;
        }

        function updateStorageDisplay() {
            const MAX_STORAGE = 2 * 1024 * 1024 * 1024; // 2GB
            const totalUsed = userFiles.reduce((sum, f) => sum + (f.size || 0), 0);
            const percent = Math.min((totalUsed / MAX_STORAGE) * 100, 100);
            
            // Circular progress calculations
            const circumference = 2 * Math.PI * 70;
            const offset = circumference - (percent / 100) * circumference;
            
            const progress1 = document.getElementById('storageProgress');
            if (progress1) {
                progress1.style.strokeDasharray = circumference;
                setTimeout(() => { progress1.style.strokeDashoffset = offset; }, 100);
            }

            const progress2 = document.getElementById('storageProgress2');
            if (progress2) {
                const circumference2 = 2 * Math.PI * 85;
                const offset2 = circumference2 - (percent / 100) * circumference2;
                progress2.style.strokeDasharray = circumference2;
                setTimeout(() => { progress2.style.strokeDashoffset = offset2; }, 100);
            }

            // Update text displays
            document.getElementById('storagePercent').textContent = `${Math.round(percent)}%`;
            document.getElementById('usedStorage').textContent = formatBytes(totalUsed);
            document.getElementById('totalStorage').textContent = formatBytes(MAX_STORAGE);
            document.getElementById('fileCount').textContent = userFiles.length;
            document.getElementById('storageBadge').textContent = `${Math.round(percent)}%`;

            const sp2 = document.getElementById('storagePercent2');
            const us2 = document.getElementById('usedStorage2');
            const fs = document.getElementById('freeStorage');
            if (sp2) sp2.textContent = `${Math.round(percent)}%`;
            if (us2) us2.textContent = formatBytes(totalUsed);
            if (fs) fs.textContent = formatBytes(MAX_STORAGE - totalUsed);

            updateStorageByType();
        }

        function updateStorageByType() {
            const typeMap = {};
            userFiles.forEach(f => {
                const type = getFileType(f.name);
                if (!typeMap[type]) typeMap[type] = { count: 0, size: 0 };
                typeMap[type].count++;
                typeMap[type].size += f.size || 0;
            });

            const container = document.getElementById('storageByType');
            if (!container) return;

            const entries = Object.entries(typeMap);
            if (entries.length === 0) {
                container.innerHTML = '<div class="empty-state"><p class="empty-state-text">No files uploaded yet</p></div>';
                return;
            }

            container.innerHTML = entries.map(([type, data]) => `
                <div class="upload-item">
                    <div class="file-icon ${type}">${type.toUpperCase()}</div>
                    <div class="file-info">
                        <div class="file-name">${getTypeName(type)} Files</div>
                        <div class="file-meta">${data.count} files ‚Ä¢ ${formatBytes(data.size)}</div>
                    </div>
                </div>
            `).join('');
        }

        function updateRecentUploads() {
            const container = document.getElementById('recentUploads');
            if (!container) return;

            const recent = userFiles.slice(0, 5);

            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <span data-feather="upload-cloud" style="width: 32px; height: 32px;"></span>
                        </div>
                        <h4 class="empty-state-title">No uploads yet</h4>
                        <p class="empty-state-text">Upload your first file to get started</p>
                    </div>
                `;
            } else {
                container.innerHTML = recent.map(file => createFileItem(file, false)).join('');
            }
            feather.replace();
        }

        function updateAllFiles() {
            const container = document.getElementById('allFiles');
            const countEl = document.getElementById('filesCount');
            if (!container) return;

            const folderFilter = document.getElementById('folderFilter')?.value || '';
            const searchTerm = document.getElementById('searchInput')?.value?.toLowerCase() || '';
            
            let filtered = [...userFiles];
            
            if (folderFilter) {
                filtered = filtered.filter(f => f.folder === folderFilter);
            }
            
            if (searchTerm) {
                filtered = filtered.filter(f => f.name.toLowerCase().includes(searchTerm));
            }

            if (countEl) countEl.textContent = `${filtered.length} files`;

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <span data-feather="file" style="width: 32px; height: 32px;"></span>
                        </div>
                        <h4 class="empty-state-title">No files found</h4>
                        <p class="empty-state-text">${searchTerm || folderFilter ? 'Try different filters' : 'Upload files to see them here'}</p>
                    </div>
                `;
            } else {
                container.innerHTML = filtered.map(file => createFileItem(file, true)).join('');
            }
            feather.replace();
        }

        function createFileItem(file, showActions = false) {
            const type = getFileType(file.name);
            const actions = showActions ? `
                <div class="file-actions">
                    <button class="file-action-btn" onclick="window.downloadFile('${file.id}')" title="Download">
                        <span data-feather="download" style="width: 16px; height: 16px;"></span>
                    </button>
                    <button class="file-action-btn delete" onclick="window.deleteFile('${file.id}')" title="Delete">
                        <span data-feather="trash-2" style="width: 16px; height: 16px;"></span>
                    </button>
                </div>
            ` : '';

            // Handle Firestore timestamp
            const uploadedAt = file.uploadedAt?.toDate ? file.uploadedAt.toDate() : new Date(file.uploadedAt);
            
            return `
                <div class="upload-item">
                    <div class="file-icon ${type}">${type.toUpperCase()}</div>
                    <div class="file-info">
                        <div class="file-name">${escapeHtml(file.name)}</div>
                        <div class="file-meta">
                            <span>${formatBytes(file.size)}</span>
                            <span>‚Ä¢</span>
                            <span>${formatDate(uploadedAt)}</span>
                            ${file.folder ? `<span>‚Ä¢</span><span>üìÅ ${escapeHtml(file.folder)}</span>` : ''}
                        </div>
                    </div>
                    ${actions}
                </div>
            `;
        }

        function updateFoldersGrid() {
            const container = document.getElementById('foldersGrid');
            if (!container) return;

            if (userFolders.length === 0) {
                container.innerHTML = '<div class="empty-state" style="grid-column: 1 / -1;"><p class="empty-state-text">No folders yet</p></div>';
                return;
            }

            container.innerHTML = userFolders.slice(0, 6).map(folder => {
                const count = userFiles.filter(f => f.folder === folder.name).length;
                const size = userFiles.filter(f => f.folder === folder.name).reduce((s, f) => s + (f.size || 0), 0);
                
                return `
                    <div class="folder-item" onclick="window.openFolder('${escapeHtml(folder.name)}')">
                        <div class="folder-icon">
                            <span data-feather="folder"></span>
                        </div>
                        <div class="folder-name">${escapeHtml(folder.name)}</div>
                        <div class="folder-meta">${count} files ‚Ä¢ ${formatBytes(size)}</div>
                    </div>
                `;
            }).join('');
            
            feather.replace();
        }

        function updateFolderSelects() {
            const options = userFolders.map(f => `<option value="${escapeHtml(f.name)}">${escapeHtml(f.name)}</option>`).join('');
            
            const uploadSelect = document.getElementById('uploadFolder');
            const filterSelect = document.getElementById('folderFilter');
            
            if (uploadSelect) uploadSelect.innerHTML = `<option value="">Root (No Folder)</option>${options}`;
            if (filterSelect) filterSelect.innerHTML = `<option value="">All Folders</option>${options}`;
        }

        function updateActivityList() {
            const container = document.getElementById('activityList');
            if (!container) return;

            if (userActivities.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <span data-feather="activity" style="width: 32px; height: 32px;"></span>
                        </div>
                        <h4 class="empty-state-title">No activity yet</h4>
                        <p class="empty-state-text">Your actions will appear here</p>
                    </div>
                `;
            } else {
                container.innerHTML = userActivities.slice(0, 30).map(activity => {
                    const timestamp = activity.timestamp?.toDate ? activity.timestamp.toDate() : new Date(activity.timestamp);
                    
                    return `
                        <div class="upload-item">
                            <div class="file-icon orange">
                                <span data-feather="${getActivityIcon(activity.action)}"></span>
                            </div>
                            <div class="file-info">
                                <div class="file-name">${escapeHtml(activity.action)}</div>
                                <div class="file-meta">
                                    ${activity.details ? `<span>${escapeHtml(activity.details)}</span><span>‚Ä¢</span>` : ''}
                                    <span>${formatDate(timestamp)}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            feather.replace();
        }

        function updateStats() {
            const today = new Date().toDateString();
            const todayUploads = userFiles.filter(f => {
                const date = f.uploadedAt?.toDate ? f.uploadedAt.toDate() : new Date(f.uploadedAt);
                return date.toDateString() === today;
            }).length;
            
            document.getElementById('totalFiles').textContent = userFiles.length;
            document.getElementById('totalFolders').textContent = userFolders.length;
            document.getElementById('todayUploads').textContent = todayUploads;
        }

        function updateSecurityPage() {
            if (!currentUser || !userProfile) return;
            
            const nameEl = document.getElementById('securityName');
            const emailEl = document.getElementById('securityEmail');
            const joinedEl = document.getElementById('securityJoined');
            
            if (nameEl) nameEl.textContent = userProfile.name || currentUser.displayName || 'User';
            if (emailEl) emailEl.textContent = currentUser.email || '';
            if (joinedEl) {
                const createdAt = userProfile.createdAt?.toDate ? userProfile.createdAt.toDate() : new Date();
                joinedEl.textContent = formatDate(createdAt);
            }
        }

        // ============================================
        // CHART (Preserved from original)
        // ============================================
        function initChart() {
            const ctx = document.getElementById('analyticsChart');
            if (!ctx) return;

            if (analyticsChart) analyticsChart.destroy();

            const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 200);
            gradient.addColorStop(0, 'rgba(232, 122, 46, 0.3)');
            gradient.addColorStop(1, 'rgba(232, 122, 46, 0)');

            // Generate data based on actual uploads
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date().getDay();
            const labels = [];
            const data = [];
            
            for (let i = 6; i >= 0; i--) {
                const dayIndex = (today - i + 7) % 7;
                labels.push(days[dayIndex]);
                
                const targetDate = new Date();
                targetDate.setDate(targetDate.getDate() - i);
                const count = userFiles.filter(f => {
                    const date = f.uploadedAt?.toDate ? f.uploadedAt.toDate() : new Date(f.uploadedAt);
                    return date.toDateString() === targetDate.toDateString();
                }).length;
                data.push(count);
            }

            analyticsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Uploads',
                        data,
                        borderColor: '#e87a2e',
                        backgroundColor: gradient,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#e87a2e',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)', drawBorder: false },
                            ticks: { color: 'rgba(255, 255, 255, 0.5)' }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)', drawBorder: false },
                            ticks: { color: 'rgba(255, 255, 255, 0.5)', stepSize: 1 },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ============================================
        // NAVIGATION (Preserved from original)
        // ============================================
        window.switchPage = function(page) {
            document.querySelectorAll('.nav-item[data-page]').forEach(item => {
                item.classList.toggle('active', item.dataset.page === page);
            });

            document.querySelectorAll('.dashboard-page').forEach(p => {
                p.classList.remove('active');
            });

            const pageEl = document.getElementById(`${page}Page`);
            if (pageEl) pageEl.classList.add('active');

            const titles = {
                home: ['Dashboard', 'Overview'],
                storage: ['Storage', 'Management'],
                files: ['Files', 'All Files'],
                activity: ['Activity', 'Log'],
                security: ['Security', 'Settings'],
                settings: ['Settings', 'Profile']
            };

            document.getElementById('pageTitle').textContent = titles[page]?.[0] || 'Dashboard';
            document.getElementById('breadcrumbCurrent').textContent = titles[page]?.[1] || 'Overview';

            if (page === 'home') initChart();
            
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
                document.getElementById('sidebarOverlay').classList.remove('active');
            }

            feather.replace();
        };

        window.toggleSidebar = function() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        };

        window.openFolder = function(folderName) {
            window.switchPage('files');
            setTimeout(() => {
                const filter = document.getElementById('folderFilter');
                if (filter) {
                    filter.value = folderName;
                    window.filterByFolder();
                }
            }, 100);
        };

        window.filterByFolder = function() {
            updateAllFiles();
        };

        window.handleSearch = function() {
            updateAllFiles();
        };

        window.refreshData = async function() {
            showToast('Refreshing data...', 'info');
            // Real-time listeners auto-update, but we can force a re-render
            updateUI();
            showToast('Data refreshed!', 'success');
        };

        // ============================================
        // MODALS (Preserved from original)
        // ============================================
        window.openUploadModal = function() {
            document.getElementById('uploadModal').classList.add('active');
            selectedFiles = [];
            document.getElementById('selectedFiles').innerHTML = '';
            document.getElementById('fileInput').value = '';
            feather.replace();
        };

        window.openFolderModal = function() {
            document.getElementById('folderModal').classList.add('active');
            document.getElementById('folderName').value = '';
            feather.replace();
        };

        window.closeModal = function(modalId) {
            document.getElementById(modalId).classList.remove('active');
        };

        // ============================================
        // FILE INPUT HANDLING (Preserved from original)
        // ============================================
        function setupFileInput() {
            const zone = document.getElementById('uploadZone');
            const input = document.getElementById('fileInput');

            zone.addEventListener('click', () => input.click());

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event => {
                zone.addEventListener(event, e => {
                    e.preventDefault();
                    e.stopPropagation();
                });
            });

            ['dragenter', 'dragover'].forEach(event => {
                zone.addEventListener(event, () => zone.classList.add('dragover'));
            });

            ['dragleave', 'drop'].forEach(event => {
                zone.addEventListener(event, () => zone.classList.remove('dragover'));
            });

            zone.addEventListener('drop', e => {
                handleFiles(e.dataTransfer.files);
            });

            input.addEventListener('change', e => {
                handleFiles(e.target.files);
            });
        }

        function handleFiles(files) {
            selectedFiles = Array.from(files);
            displaySelectedFiles();
        }

        function displaySelectedFiles() {
            const container = document.getElementById('selectedFiles');
            
            if (selectedFiles.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = `
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">
                    ${selectedFiles.length} file(s) selected (${formatBytes(selectedFiles.reduce((s, f) => s + f.size, 0))})
                </p>
                ${selectedFiles.map((file, i) => `
                    <div class="upload-item" style="margin-bottom: 8px;">
                        <div class="file-icon ${getFileType(file.name)}">${getFileType(file.name).toUpperCase()}</div>
                        <div class="file-info">
                            <div class="file-name">${escapeHtml(file.name)}</div>
                            <div class="file-meta">${formatBytes(file.size)}</div>
                        </div>
                        <button class="file-action-btn delete" onclick="window.removeFile(${i})">
                            <span data-feather="x" style="width: 16px; height: 16px;"></span>
                        </button>
                    </div>
                `).join('')}
            `;
            feather.replace();
        }

        window.removeFile = function(index) {
            selectedFiles.splice(index, 1);
            displaySelectedFiles();
        };

        // ============================================
        // SETTINGS (Preserved from original)
        // ============================================
        async function handleSettingsSubmit(e) {
            e.preventDefault();
            
            const name = document.getElementById('settingsName').value.trim();
            
            if (!name) {
                showToast('Name cannot be empty', 'warning');
                return;
            }

            try {
                // Update Firebase Auth profile
                await updateProfile(currentUser, { displayName: name });
                
                // Update Firestore
                await setDoc(doc(db, "users", currentUser.uid), {
                    name: name
                }, { merge: true });

                // Refresh local data
                userProfile.name = name;
                updateUserInfo();
                showToast('Profile updated!', 'success');
            } catch (error) {
                console.error('Settings error:', error);
                showToast('Failed to update profile', 'error');
            }
        }

        // ============================================
        // UI HELPERS (Preserved from original)
        // ============================================
        function showDashboard() {
            document.getElementById('authPage').classList.remove('active');
            document.getElementById('dashboardPage').classList.add('active');
            document.getElementById('loadingOverlay').classList.add('hidden');
            updateUI();
            initChart();
            feather.replace();
        }

        function showSignUp() {
            document.getElementById('signInForm').style.display = 'none';
            document.getElementById('signUpForm').style.display = 'block';
            document.getElementById('loginError').classList.remove('show');
            feather.replace();
        }

        function showSignIn() {
            document.getElementById('signUpForm').style.display = 'none';
            document.getElementById('signInForm').style.display = 'block';
            document.getElementById('signupError').classList.remove('show');
            feather.replace();
        }

        function showAuthError(element, message) {
            element.textContent = message;
            element.classList.add('show');
            setTimeout(() => element.classList.remove('show'), 5000);
        }

        // Expose functions to window for HTML onclick handlers
        window.showSignUp = showSignUp;
        window.showSignIn = showSignIn;
        window.handleLogout = handleLogout;
        window.downloadFile = downloadFile;
        window.deleteFile = deleteFile;

        // ============================================
        // UTILITIES (Preserved from original)
        // ============================================
        function formatBytes(bytes) {
            if (!bytes || bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(date) {
            if (!date) return '';
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            if (diff < 604800000) return `${Math.floor(diff / 86400000)}d ago`;
            
            return date.toLocaleDateString();
        }

        function getFileType(filename) {
            if (!filename) return 'default';
            const ext = filename.split('.').pop().toLowerCase();
            const types = {
                pdf: 'pdf',
                doc: 'doc', docx: 'doc', txt: 'doc', rtf: 'doc',
                jpg: 'img', jpeg: 'img', png: 'img', gif: 'img', webp: 'img', svg: 'img', bmp: 'img',
                zip: 'zip', rar: 'zip', '7z': 'zip', tar: 'zip', gz: 'zip',
                mp4: 'vid', avi: 'vid', mov: 'vid', mkv: 'vid', webm: 'vid',
                mp3: 'aud', wav: 'aud', flac: 'aud', aac: 'aud', ogg: 'aud'
            };
            return types[ext] || 'default';
        }

        function getTypeName(type) {
            const names = {
                pdf: 'PDF',
                doc: 'Document',
                img: 'Image',
                zip: 'Archive',
                vid: 'Video',
                aud: 'Audio',
                default: 'Other'
            };
            return names[type] || 'Other';
        }

        function getActivityIcon(action) {
            if (action.includes('Uploaded')) return 'upload-cloud';
            if (action.includes('Downloaded')) return 'download-cloud';
            if (action.includes('Deleted')) return 'trash-2';
            if (action.includes('Created folder')) return 'folder-plus';
            if (action.includes('Logged')) return 'log-in';
            return 'activity';
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: 'check-circle',
                error: 'x-circle',
                warning: 'alert-circle',
                info: 'info'
            };

            toast.innerHTML = `
                <span class="toast-icon" data-feather="${icons[type] || 'info'}"></span>
                <div class="toast-content">
                    <div class="toast-message">${escapeHtml(message)}</div>
                </div>
            `;

            container.appendChild(toast);
            feather.replace();

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();

            // Setup event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleSignUp);
            document.getElementById('folderForm').addEventListener('submit', createFolder);
            document.getElementById('settingsForm').addEventListener('submit', handleSettingsSubmit);
            document.getElementById('uploadBtn').addEventListener('click', uploadFiles);

            setupFileInput();

            // Modal close on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', e => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', e => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
                }
            });

            // Check auth state - onAuthStateChanged handles the rest
            setTimeout(() => {
                if (!currentUser) {
                    document.getElementById('loadingOverlay').classList.add('hidden');
                }
            }, 2000);
        });
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0b;
            --bg-secondary: #111113;
            --bg-tertiary: #1a1a1d;
            --bg-card: rgba(26, 26, 29, 0.7);
            --bg-glass: rgba(255, 255, 255, 0.03);
            --border-color: rgba(255, 255, 255, 0.06);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.4);
            --accent: #e87a2e;
            --accent-light: #f59542;
            --accent-glow: rgba(232, 122, 46, 0.3);
            --success: #22c55e;
            --warning: #eab308;
            --error: #ef4444;
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 20px;
            --radius-xl: 24px;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 40px var(--accent-glow);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--bg-tertiary); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 var(--accent-glow); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px 10px var(--accent-glow); }
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--bg-tertiary);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-text {
            margin-top: 16px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Auth Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--bg-primary);
            position: relative;
            overflow: hidden;
        }

        .auth-bg-effects {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .auth-bg-effects::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, var(--accent-glow) 0%, transparent 50%),
                        radial-gradient(circle at 70% 70%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            animation: bgFloat 20s ease-in-out infinite;
        }

        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(5deg); }
            66% { transform: translate(-20px, 20px) rotate(-5deg); }
        }

        .auth-card {
            background: var(--bg-card);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 48px;
            width: 100%;
            max-width: 440px;
            position: relative;
            box-shadow: var(--shadow-lg);
            animation: fadeSlideUp 0.6s ease-out;
        }

        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
            justify-content: center;
        }

        .auth-logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-glow);
        }

        .auth-logo-icon svg { width: 24px; height: 24px; color: white; }
        .auth-logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-title { font-size: 28px; font-weight: 700; text-align: center; margin-bottom: 8px; }
        .auth-subtitle { color: var(--text-secondary); text-align: center; margin-bottom: 32px; font-size: 15px; }

        .form-group { margin-bottom: 20px; position: relative; }
        .form-label { display: block; font-size: 13px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            padding-left: 44px;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 15px;
            font-family: inherit;
            transition: var(--transition);
            outline: none;
        }

        .form-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }
        .form-input::placeholder { color: var(--text-muted); }
        .form-input:disabled { opacity: 0.6; cursor: not-allowed; }

        .form-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            transition: var(--transition);
        }

        .form-group:focus-within .form-icon { color: var(--accent); }

        .btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none !important; }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
            box-shadow: var(--shadow-sm), 0 0 20px var(--accent-glow);
        }

        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: var(--shadow-md), var(--shadow-glow); }
        .btn-primary:active:not(:disabled) { transform: translateY(0); }

        .btn-secondary {
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) { background: var(--bg-tertiary); border-color: var(--accent); }

        .auth-footer { text-align: center; margin-top: 24px; color: var(--text-secondary); font-size: 14px; }
        .auth-footer a { color: var(--accent); text-decoration: none; font-weight: 500; transition: var(--transition); cursor: pointer; }
        .auth-footer a:hover { color: var(--accent-light); }

        .auth-divider {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 24px 0;
            color: var(--text-muted);
            font-size: 13px;
        }

        .auth-divider::before, .auth-divider::after { content: ''; flex: 1; height: 1px; background: var(--border-color); }

        .auth-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--error);
            padding: 12px 16px;
            border-radius: var(--radius-md);
            font-size: 14px;
            margin-bottom: 20px;
            display: none;
        }

        .auth-error.show { display: block; animation: shake 0.5s ease; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Dashboard Layout */
        .dashboard { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--bg-card);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-right: 1px solid var(--border-color);
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: var(--transition);
        }

        .sidebar-logo { display: flex; align-items: center; gap: 12px; padding: 0 12px; margin-bottom: 32px; }

        .sidebar-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-glow);
        }

        .sidebar-logo-icon svg { width: 20px; height: 20px; color: white; }
        .sidebar-logo-text { font-size: 20px; font-weight: 700; }

        .sidebar-nav { flex: 1; display: flex; flex-direction: column; gap: 4px; }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 16px 12px 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover { background: var(--bg-glass); color: var(--text-primary); }
        .nav-item.active { background: linear-gradient(135deg, var(--accent), var(--accent-light)); color: white; box-shadow: var(--shadow-glow); }
        .nav-item svg { width: 20px; height: 20px; }

        .nav-item-badge {
            margin-left: auto;
            background: var(--accent);
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 20px;
        }

        .sidebar-footer { padding-top: 16px; border-top: 1px solid var(--border-color); margin-top: auto; }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius-md);
            background: var(--bg-glass);
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .user-info { flex: 1; min-width: 0; }
        .user-name { font-size: 14px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .user-plan { font-size: 12px; color: var(--text-muted); display: flex; align-items: center; gap: 4px; }
        .user-plan-badge { background: var(--accent); color: white; font-size: 10px; padding: 1px 6px; border-radius: 10px; font-weight: 600; }

        /* Main Content */
        .main-content { flex: 1; margin-left: 260px; display: flex; flex-direction: column; min-height: 100vh; }

        /* Top Navigation */
        .top-nav {
            background: var(--bg-card);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .top-nav-left { display: flex; align-items: center; gap: 24px; }
        .mobile-menu-btn { display: none; background: none; border: none; color: var(--text-primary); cursor: pointer; padding: 8px; }
        .page-title { font-size: 24px; font-weight: 700; }

        .breadcrumb { display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--text-muted); }
        .breadcrumb-separator { color: var(--text-muted); }
        .breadcrumb-current { color: var(--text-primary); font-weight: 500; }

        .top-nav-right { display: flex; align-items: center; gap: 16px; }

        .search-box { position: relative; }

        .search-input {
            width: 280px;
            padding: 10px 16px;
            padding-left: 40px;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: var(--transition);
            outline: none;
        }

        .search-input:focus { border-color: var(--accent); width: 320px; }
        .search-input::placeholder { color: var(--text-muted); }

        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

        .nav-icon-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .nav-icon-btn:hover { background: var(--bg-tertiary); color: var(--text-primary); border-color: var(--accent); }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 18px;
            height: 18px;
            background: var(--accent);
            border-radius: 50%;
            font-size: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Dashboard Content */
        .dashboard-content { flex: 1; padding: 32px; overflow-y: auto; }

        .dashboard-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 32px; flex-wrap: wrap; gap: 16px; }
        .welcome-text h1 { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
        .welcome-text p { color: var(--text-secondary); font-size: 15px; }
        .header-actions { display: flex; gap: 12px; }

        /* Cards Grid */
        .cards-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 24px; }

        .card {
            background: var(--bg-card);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 24px;
            transition: var(--transition);
            animation: fadeSlideUp 0.6s ease-out;
            animation-fill-mode: both;
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.15s; }
        .card:nth-child(3) { animation-delay: 0.2s; }
        .card:nth-child(4) { animation-delay: 0.25s; }
        .card:nth-child(5) { animation-delay: 0.3s; }
        .card:nth-child(6) { animation-delay: 0.35s; }

        .card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); border-color: rgba(255, 255, 255, 0.1); }

        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .card-title { font-size: 16px; font-weight: 600; }
        .card-subtitle { font-size: 13px; color: var(--text-muted); margin-top: 2px; }

        .card-icon { width: 40px; height: 40px; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; }
        .card-icon.orange { background: rgba(232, 122, 46, 0.15); color: var(--accent); }
        .card-icon.green { background: rgba(34, 197, 94, 0.15); color: var(--success); }
        .card-icon.blue { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .card-icon.purple { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }

        .col-span-4 { grid-column: span 4; }
        .col-span-5 { grid-column: span 5; }
        .col-span-6 { grid-column: span 6; }
        .col-span-7 { grid-column: span 7; }
        .col-span-8 { grid-column: span 8; }
        .col-span-12 { grid-column: span 12; }

        /* Storage Card */
        .storage-visual { display: flex; align-items: center; justify-content: center; margin: 20px 0; }

        .circular-progress { position: relative; width: 160px; height: 160px; }
        .circular-progress svg { transform: rotate(-90deg); }
        .circular-progress circle { fill: none; stroke-width: 12; stroke-linecap: round; }
        .progress-bg { stroke: var(--bg-tertiary); }
        .progress-fill { stroke: url(#progressGradient); stroke-dasharray: 440; stroke-dashoffset: 440; transition: stroke-dashoffset 1.5s ease-out; }

        .progress-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .progress-value { font-size: 36px; font-weight: 700; }
        .progress-label { font-size: 13px; color: var(--text-muted); }

        .storage-details { display: flex; justify-content: space-around; padding-top: 16px; border-top: 1px solid var(--border-color); }
        .storage-detail { text-align: center; }
        .storage-detail-value { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .storage-detail-label { font-size: 12px; color: var(--text-muted); }

        /* Quick Actions */
        .quick-actions-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }

        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 20px;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-action-btn:hover { background: var(--bg-tertiary); border-color: var(--accent); transform: translateY(-2px); }
        .quick-action-btn:hover .quick-action-icon { background: var(--accent); color: white; }

        .quick-action-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .quick-action-text { font-size: 13px; font-weight: 500; }

        /* Recent Uploads */
        .uploads-list { display: flex; flex-direction: column; gap: 12px; max-height: 400px; overflow-y: auto; }

        .upload-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-glass);
            border-radius: var(--radius-md);
            transition: var(--transition);
        }

        .upload-item:hover { background: var(--bg-tertiary); }

        .file-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
        }

        .file-icon.pdf { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .file-icon.doc { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .file-icon.img { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
        .file-icon.zip { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
        .file-icon.vid { background: rgba(236, 72, 153, 0.15); color: #ec4899; }
        .file-icon.aud { background: rgba(234, 179, 8, 0.15); color: #eab308; }
        .file-icon.default { background: rgba(255, 255, 255, 0.1); color: var(--text-secondary); }

        .file-info { flex: 1; min-width: 0; }
        .file-name { font-size: 14px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-meta { font-size: 12px; color: var(--text-muted); display: flex; gap: 8px; flex-wrap: wrap; }

        .file-actions { display: flex; gap: 8px; }

        .file-action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            background: transparent;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            cursor: pointer;
            transition: var(--transition);
        }

        .file-action-btn:hover { background: var(--bg-tertiary); color: var(--text-primary); border-color: var(--border-color); }
        .file-action-btn.delete:hover { background: rgba(239, 68, 68, 0.15); color: #ef4444; border-color: rgba(239, 68, 68, 0.3); }

        /* Folders Grid */
        .folders-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }

        .folder-item {
            padding: 16px;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition);
        }

        .folder-item:hover { background: var(--bg-tertiary); border-color: var(--accent); transform: translateY(-2px); }

        .folder-icon {
            width: 40px;
            height: 40px;
            background: rgba(232, 122, 46, 0.15);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            margin-bottom: 12px;
        }

        .folder-name { font-size: 14px; font-weight: 500; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .folder-meta { font-size: 12px; color: var(--text-muted); }

        /* Analytics */
        .analytics-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
        .analytics-tabs { display: flex; gap: 4px; background: var(--bg-glass); padding: 4px; border-radius: var(--radius-sm); }

        .analytics-tab {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-muted);
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .analytics-tab.active { background: var(--accent); color: white; }
        .analytics-tab:hover:not(.active) { color: var(--text-primary); }

        .chart-container { height: 200px; margin-bottom: 20px; }

        .analytics-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .analytics-stat { padding: 16px; background: var(--bg-glass); border-radius: var(--radius-md); text-align: center; }
        .stat-value { font-size: 24px; font-weight: 700; color: var(--accent); margin-bottom: 4px; }
        .stat-label { font-size: 12px; color: var(--text-muted); }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 20px;
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 32px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: var(--transition);
        }

        .modal-overlay.active .modal { transform: scale(1); }

        .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
        .modal-title { font-size: 20px; font-weight: 600; }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover { background: var(--error); border-color: var(--error); color: white; }

        .upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-lg);
            padding: 40px 20px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .upload-zone:hover, .upload-zone.dragover { border-color: var(--accent); background: rgba(232, 122, 46, 0.05); }

        .upload-zone-icon {
            width: 64px;
            height: 64px;
            border-radius: var(--radius-lg);
            background: rgba(232, 122, 46, 0.15);
            color: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }

        .upload-zone-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .upload-zone-text { font-size: 14px; color: var(--text-muted); }
        .upload-zone-text span { color: var(--accent); font-weight: 500; }

        /* Toast */
        .toast-container { position: fixed; bottom: 24px; right: 24px; display: flex; flex-direction: column; gap: 12px; z-index: 2000; }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            animation: toastIn 0.3s ease-out;
        }

        @keyframes toastIn { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }

        .toast.success { border-left: 3px solid var(--success); }
        .toast.error { border-left: 3px solid var(--error); }
        .toast.warning { border-left: 3px solid var(--warning); }
        .toast.info { border-left: 3px solid #3b82f6; }

        .toast-icon { width: 24px; height: 24px; flex-shrink: 0; }
        .toast.success .toast-icon { color: var(--success); }
        .toast.error .toast-icon { color: var(--error); }
        .toast.warning .toast-icon { color: var(--warning); }
        .toast.info .toast-icon { color: #3b82f6; }

        .toast-content { flex: 1; }
        .toast-message { font-size: 14px; color: var(--text-primary); }

        /* Empty State */
        .empty-state { text-align: center; padding: 40px 20px; }
        .empty-state-icon { width: 80px; height: 80px; border-radius: var(--radius-lg); background: var(--bg-glass); display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; color: var(--text-muted); }
        .empty-state-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .empty-state-text { font-size: 14px; color: var(--text-muted); }

        /* Security Badge */
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            color: var(--success);
        }

        .security-badge svg { width: 14px; height: 14px; }

        /* Upload Progress */
        .upload-progress-overlay {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            min-width: 320px;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .upload-progress-overlay.active { opacity: 1; visibility: visible; }
        .upload-progress-info { flex: 1; }
        .upload-progress-name { font-size: 14px; font-weight: 500; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .upload-progress-bar-container { height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden; }
        .upload-progress-bar-fill { height: 100%; background: linear-gradient(135deg, var(--accent), var(--accent-light)); border-radius: 3px; transition: width 0.3s ease; }
        .upload-progress-percent { font-size: 14px; font-weight: 600; color: var(--accent); }

        /* Responsive */
        @media (max-width: 1200px) {
            .col-span-4, .col-span-5, .col-span-7, .col-span-8 { grid-column: span 6; }
            .folders-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .mobile-menu-btn { display: flex; }
            .col-span-4, .col-span-5, .col-span-6, .col-span-7, .col-span-8, .col-span-12 { grid-column: span 12; }
            .top-nav { padding: 12px 16px; }
            .search-box { display: none; }
            .dashboard-content { padding: 16px; }
            .cards-grid { gap: 16px; }
            .folders-grid { grid-template-columns: 1fr; }
            .analytics-stats { grid-template-columns: 1fr; }
            .modal { margin: 16px; padding: 24px; }
            .auth-card { padding: 32px 24px; }
        }

        .page { display: none; }
        .page.active { display: block; }
        .dashboard-page { display: none; }
        .dashboard-page.active { display: block; animation: fadeSlideUp 0.4s ease-out; }

        /* Sidebar overlay for mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
        }

        .sidebar-overlay.active { display: block; }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-logo">
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" width="40" height="40">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            </svg>
        </div>
        <div class="loading-spinner"></div>
        <p class="loading-text" id="loadingText">Initializing CloudVault...</p>
    </div>

    <!-- Auth Pages -->
    <div id="authPage" class="page">
        <div class="auth-container">
            <div class="auth-bg-effects"></div>
            
            <!-- Sign In -->
            <div id="signInForm" class="auth-card">
                <div class="auth-logo">
                    <div class="auth-logo-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        </svg>
                    </div>
                    <span class="auth-logo-text">CloudVault</span>
                </div>

                <h1 class="auth-title">Welcome back</h1>
                <p class="auth-subtitle">Sign in to access your secure cloud storage</p>

                <div class="auth-error" id="loginError"></div>

                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <div style="position: relative;">
                            <span class="form-icon" data-feather="mail" style="width: 18px; height: 18px;"></span>
                            <input type="email" class="form-input" placeholder="Enter your email" required id="loginEmail">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div style="position: relative;">
                            <span class="form-icon" data-feather="lock" style="width: 18px; height: 18px;"></span>
                            <input type="password" class="form-input" placeholder="Enter your password" required id="loginPassword">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" id="loginBtn" style="margin-top: 8px;">
                        <span data-feather="log-in" style="width: 18px; height: 18px;"></span>
                        Sign In
                    </button>
                </form>

                <p class="auth-footer">
                    Don't have an account? <a onclick="showSignUp()">Sign up</a>
                </p>
            </div>

            <!-- Sign Up -->
            <div id="signUpForm" class="auth-card" style="display: none;">
                <div class="auth-logo">
                    <div class="auth-logo-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        </svg>
                    </div>
                    <span class="auth-logo-text">CloudVault</span>
                </div>

                <h1 class="auth-title">Create account</h1>
                <p class="auth-subtitle">Start your secure cloud storage journey</p>

                <div class="auth-error" id="signupError"></div>

                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <div style="position: relative;">
                            <span class="form-icon" data-feather="user" style="width: 18px; height: 18px;"></span>
                            <input type="text" class="form-input" placeholder="Enter your name" required id="signupName">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <div style="position: relative;">
                            <span class="form-icon" data-feather="mail" style="width: 18px; height: 18px;"></span>
                            <input type="email" class="form-input" placeholder="Enter your email" required id="signupEmail">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div style="position: relative;">
                            <span class="form-icon" data-feather="lock" style="width: 18px; height: 18px;"></span>
                            <input type="password" class="form-input" placeholder="Create a password (min 6 chars)" required id="signupPassword" minlength="6">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" id="signupBtn" style="margin-top: 8px;">
                        <span data-feather="user-plus" style="width: 18px; height: 18px;"></span>
                        Create Account
                    </button>
                </form>

                <p class="auth-footer">
                    Already have an account? <a onclick="showSignIn()">Sign in</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" class="page">
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        <div class="dashboard">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        </svg>
                    </div>
                    <span class="sidebar-logo-text">CloudVault</span>
                </div>

                <nav class="sidebar-nav">
                    <span class="nav-section-title">Main Menu</span>
                    
                    <button class="nav-item active" data-page="home" onclick="switchPage('home')">
                        <span data-feather="home"></span>
                        Home
                    </button>
                    
                    <button class="nav-item" data-page="storage" onclick="switchPage('storage')">
                        <span data-feather="hard-drive"></span>
                        Storage
                        <span class="nav-item-badge" id="storageBadge">0%</span>
                    </button>
                    
                    <button class="nav-item" data-page="files" onclick="switchPage('files')">
                        <span data-feather="file-text"></span>
                        Files
                    </button>
                    
                    <button class="nav-item" data-page="activity" onclick="switchPage('activity')">
                        <span data-feather="activity"></span>
                        Activity
                    </button>

                    <span class="nav-section-title">Account</span>
                    
                    <button class="nav-item" data-page="security" onclick="switchPage('security')">
                        <span data-feather="shield"></span>
                        Security
                    </button>
                    
                    <button class="nav-item" data-page="settings" onclick="switchPage('settings')">
                        <span data-feather="settings"></span>
                        Settings
                    </button>
                </nav>

                <div class="sidebar-footer">
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">User</div>
                            <div class="user-plan">
                                <span class="user-plan-badge">FREE</span>
                                Member
                            </div>
                        </div>
                    </div>
                    
                    <button class="nav-item" onclick="handleLogout()">
                        <span data-feather="log-out"></span>
                        Logout
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Top Navigation -->
                <header class="top-nav">
                    <div class="top-nav-left">
                        <button class="mobile-menu-btn" onclick="toggleSidebar()">
                            <span data-feather="menu"></span>
                        </button>
                        <div>
                            <h1 class="page-title" id="pageTitle">Dashboard</h1>
                            <div class="breadcrumb">
                                <span>Home</span>
                                <span class="breadcrumb-separator">/</span>
                                <span class="breadcrumb-current" id="breadcrumbCurrent">Overview</span>
                            </div>
                        </div>
                    </div>

                    <div class="top-nav-right">
                        <div class="search-box">
                            <span class="search-icon" data-feather="search" style="width: 18px; height: 18px;"></span>
                            <input type="text" class="search-input" placeholder="Search files..." id="searchInput" oninput="handleSearch()">
                        </div>
                        
                        <button class="nav-icon-btn" onclick="refreshData()">
                            <span data-feather="refresh-cw" style="width: 18px; height: 18px;"></span>
                        </button>
                        
                        <button class="nav-icon-btn" onclick="openUploadModal()">
                            <span data-feather="upload" style="width: 18px; height: 18px;"></span>
                        </button>
                    </div>
                </header>

                <!-- Dashboard Content -->
                <div class="dashboard-content">
                    <!-- Home Page -->
                    <div id="homePage" class="dashboard-page active">
                        <div class="dashboard-header">
                            <div class="welcome-text">
                                <h1>Good <span id="greeting">morning</span>, <span id="welcomeName">User</span>! üëã</h1>
                                <p>Here's what's happening with your storage today.</p>
                            </div>
                            <div class="header-actions">
                                <div class="security-badge">
                                    <span data-feather="shield"></span>
                                    Telegram Secured
                                </div>
                            </div>
                        </div>

                        <div class="cards-grid">
                            <!-- Storage Card -->
                            <div class="card col-span-4">
                                <div class="card-header">
                                    <div>
                                        <h3 class="card-title">Storage Usage</h3>
                                        <p class="card-subtitle">Your cloud storage overview</p>
                                    </div>
                                    <div class="card-icon orange">
                                        <span data-feather="hard-drive"></span>
                                    </div>
                                </div>

                                <div class="storage-visual">
                                    <div class="circular-progress">
                                        <svg width="160" height="160">
                                            <defs>
                                                <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#e87a2e"/>
                                                    <stop offset="100%" style="stop-color:#f59542"/>
                                                </linearGradient>
                                            </defs>
                                            <circle class="progress-bg" cx="80" cy="80" r="70"></circle>
                                            <circle class="progress-fill" id="storageProgress" cx="80" cy="80" r="70"></circle>
                                        </svg>
                                        <div class="progress-center">
                                            <span class="progress-value" id="storagePercent">0%</span>
                                            <span class="progress-label">Used</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="storage-details">
                                    <div class="storage-detail">
                                        <div class="storage-detail-value" id="usedStorage">0 MB</div>
                                        <div class="storage-detail-label">Used</div>
                                    </div>
                                    <div class="storage-detail">
                                        <div class="storage-detail-value" id="totalStorage">2 GB</div>
                                        <div class="storage-detail-label">Total</div>
                                    </div>
                                    <div class="storage-detail">
                                        <div class="storage-detail-value" id="fileCount">0</div>
                                        <div class="storage-detail-label">Files</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="card col-span-4">
                                <div class="card-header">
                                    <div>
                                        <h3 class="card-title">Quick Actions</h3>
                                        <p class="card-subtitle">Frequently used operations</p>
                                    </div>
                                    <div class="card-icon blue">
                                        <span data-feather="zap"></span>
                                    </div>
                                </div>

                                <div class="quick-actions-grid">
                                    <button class="quick-action-btn" onclick="openUploadModal()">
                                        <div class="quick-action-icon">
                                            <span data-feather="upload-cloud"></span>
                                        </div>
                                        <span class="quick-action-text">Upload File</span>
                                    </button>
                                    
                                    <button class="quick-action-btn" onclick="openFolderModal()">
                                        <div class="quick-action-icon">
                                            <span data-feather="folder-plus"></span>
                                        </div>
                                        <span class="quick-action-text">New Folder</span>
                                    </button>
                                    
                                    <button class="quick-action-btn" onclick="refreshData()">
                                        <div class="quick-action-icon">
                                            <span data-feather="refresh-cw"></span>
                                        </div>
                                        <span class="quick-action-text">Refresh</span>
                                    </button>
                                    
                                    <button class="quick-action-btn" onclick="switchPage('files')">
                                        <div class="quick-action-icon">
                                            <span data-feather="search"></span>
                                        </div>
                                        <span class="quick-action-text">Browse Files</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Folders Overview -->
                            <div class="card col-span-4">
                                <div class="card-header">
                                    <div>
                                        <h3 class="card-title">Folders</h3>
                                        <p class="card-subtitle">Your file organization</p>
                                    </div>
                                    <div class="card-icon purple">
                                        <span data-feather="folder"></span>
                                    </div>
                                </div>

                                <div class="folders-grid" id="foldersGrid">
                                    <div class="empty-state">
                                        <p class="empty-state-text">No folders yet</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Uploads -->
                            <div class="card col-span-5">
                                <div class="card-header">
                                    <div>
                                        <h3 class="card-title">Recent Uploads</h3>
                                        <p class="card-subtitle">Your latest files</p>
                                    </div>
                                    <div class="card-icon green">
                                        <span data-feather="clock"></span>
                                    </div>
                                </div>

                                <div class="uploads-list" id="recentUploads">
                                    <div class="empty-state">
                                        <div class="empty-state-icon">
                                            <span data-feather="upload-cloud" style="width: 32px; height: 32px;"></span>
                                        </div>
                                        <h4 class="empty-state-title">No uploads yet</h4>
                                        <p class="empty-state-text">Upload your first file to get started</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Analytics -->
                            <div class="card col-span-7">
                                <div class="analytics-header">
                                    <div>
                                        <h3 class="card-title">Usage Analytics</h3>
                                        <p class="card-subtitle">Storage trends over time</p>
                                    </div>
                                </div>

                                <div class="chart-container">
                                    <canvas id="analyticsChart"></canvas>
                                </div>

                                <div class="analytics-stats">
                                    <div class="analytics-stat">
                                        <div class="stat-value" id="totalFiles">0</div>
                                        <div class="stat-label">Total Files</div>
                                    </div>
                                    <div class="analytics-stat">
                                        <div class="stat-value" id="totalFolders">0</div>
                                        <div class="stat-label">Folders</div>
                                    </div>
                                    <div class="analytics-stat">
                                        <div class="stat-value" id="todayUploads">0</div>
                                        <div class="stat-label">Today's Uploads</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Files Page -->
                    <div id="filesPage" class="dashboard-page">
                        <div class="dashboard-header">
                            <div class="welcome-text">
                                <h1>All Files</h1>
                                <p>Manage and organize your files</p>
                            </div>
                            <div class="header-actions">
                                <button class="btn btn-primary" onclick="openUploadModal()" style="width: auto; padding: 12px 24px;">
                                    <span data-feather="upload"></span>
                                    Upload
                                </button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">Files List</h3>
                                    <p class="card-subtitle" id="filesCount">0 files</p>
                                </div>
                                <select id="folderFilter" class="form-input" style="width: auto; padding: 10px 16px;" onchange="filterByFolder()">
                                    <option value="">All Folders</option>
                                </select>
                            </div>

                            <div class="uploads-list" id="allFiles">
                                <div class="empty-state">
                                    <div class="empty-state-icon">
                                        <span data-feather="file" style="width: 32px; height: 32px;"></span>
                                    </div>
                                    <h4 class="empty-state-title">No files found</h4>
                                    <p class="empty-state-text">Upload files to see them here</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Storage Page -->
                    <div id="storagePage" class="dashboard-page">
                        <div class="dashboard-header">
                            <div class="welcome-text">
                                <h1>Storage Management</h1>
                                <p>View your storage breakdown</p>
                            </div>
                        </div>

                        <div class="cards-grid">
                            <div class="card col-span-6">
                                <div class="card-header">
                                    <div>
                                        <h3 class="card-title">Storage Overview</h3>
                                        <p class="card-subtitle">Detailed breakdown</p>
                                    </div>
                                </div>

                                <div class="storage-visual">
                                    <div class="circular-progress" style="width: 200px; height: 200px;">
                                        <svg width="200" height="200">
                                            <circle class="progress-bg" cx="100" cy="100" r="85" stroke-width="14"></circle>
                                            <circle class="progress-fill" id="storageProgress2" cx="100" cy="100" r="85" stroke-width="14" style="stroke-dasharray: 534;"></circle>
                                        </svg>
                                        <div class="progress-center">
                                            <span class="progress-value" id="storagePercent2">0%</span>
                                            <span class="progress-label">Used</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="storage-details">
                                    <div class="storage-detail">
                                        <div class="storage-detail-value" id="usedStorage2">0 MB</div>
                                        <div class="storage-detail-label">Used</div>
                                    </div>
                                    <div class="storage-detail">
                                        <div class="storage-detail-value" id="freeStorage">2 GB</div>
                                        <div class="storage-detail-label">Free</div>
                                    </div>
                                </div>
                            </div>

                            <div class="card col-span-6">
                                <div class="card-header">
                                    <div>
                                        <h3 class="card-title">Storage by Type</h3>
                                        <p class="card-subtitle">File type distribution</p>
                                    </div>
                                </div>

                                <div id="storageByType" class="uploads-list">
                                    <div class="empty-state">
                                        <p class="empty-state-text">No files uploaded yet</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Page -->
                    <div id="activityPage" class="dashboard-page">
                        <div class="dashboard-header">
                            <div class="welcome-text">
                                <h1>Activity Log</h1>
                                <p>Track your recent actions</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">Recent Activity</h3>
                                    <p class="card-subtitle">Your file operations history</p>
                                </div>
                            </div>

                            <div class="uploads-list" id="activityList">
                                <div class="empty-state">
                                    <div class="empty-state-icon">
                                        <span data-feather="activity" style="width: 32px; height: 32px;"></span>
                                    </div>
                                    <h4 class="empty-state-title">No activity yet</h4>
                                    <p class="empty-state-text">Your actions will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Page -->
                    <div id="securityPage" class="dashboard-page">
                        <div class="dashboard-header">
                            <div class="welcome-text">
                                <h1>Security Settings</h1>
                                <p>Manage your account security</p>
                            </div>
                        </div>

                        <div class="cards-grid">
                            <div class="card col-span-6">
                                <div class="card-header">
                                    <div>
                                        <h3 class="card-title">Security Status</h3>
                                        <p class="card-subtitle">Your account protection level</p>
                                    </div>
                                    <div class="security-badge">
                                        <span data-feather="shield"></span>
                                        Protected
                                    </div>
                                </div>

                                <div style="padding: 20px 0;">
                                    <div class="upload-item" style="margin-bottom: 12px;">
                                        <div class="file-icon" style="background: rgba(34, 197, 94, 0.15); color: #22c55e;">‚úì</div>
                                        <div class="file-info">
                                            <div class="file-name">Telegram Backend</div>
                                            <div class="file-meta">Files stored securely in Telegram</div>
                                        </div>
                                    </div>
                                    
                                    <div class="upload-item" style="margin-bottom: 12px;">
                                        <div class="file-icon" style="background: rgba(34, 197, 94, 0.15); color: #22c55e;">‚úì</div>
                                        <div class="file-info">
                                            <div class="file-name">Private Storage</div>
                                            <div class="file-meta">Only you can access your files</div>
                                        </div>
                                    </div>
                                    
                                    <div class="upload-item" style="margin-bottom: 12px;">
                                        <div class="file-icon" style="background: rgba(34, 197, 94, 0.15); color: #22c55e;">‚úì</div>
                                        <div class="file-info">
                                            <div class="file-name">Firebase Auth</div>
                                            <div class="file-meta">Secure authentication</div>
                                        </div>
                                    </div>
                                    
                                    <div class="upload-item">
                                        <div class="file-icon" style="background: rgba(34, 197, 94, 0.15); color: #22c55e;">‚úì</div>
                                        <div class="file-info">
                                            <div class="file-name">Firestore Security</div>
                                            <div class="file-meta">Database protected by security rules</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card col-span-6">
                                <div class="card-header">
                                    <div>
                                        <h3 class="card-title">Account Info</h3>
                                        <p class="card-subtitle">Your account details</p>
                                    </div>
                                </div>

                                <div style="padding: 20px 0;">
                                    <div class="upload-item" style="margin-bottom: 12px;">
                                        <div class="file-icon orange"><span data-feather="user"></span></div>
                                        <div class="file-info">
                                            <div class="file-name" id="securityName">-</div>
                                            <div class="file-meta">Display Name</div>
                                        </div>
                                    </div>
                                    
                                    <div class="upload-item" style="margin-bottom: 12px;">
                                        <div class="file-icon blue"><span data-feather="mail"></span></div>
                                        <div class="file-info">
                                            <div class="file-name" id="securityEmail">-</div>
                                            <div class="file-meta">Email Address</div>
                                        </div>
                                    </div>
                                    
                                    <div class="upload-item">
                                        <div class="file-icon purple"><span data-feather="calendar"></span></div>
                                        <div class="file-info">
                                            <div class="file-name" id="securityJoined">-</div>
                                            <div class="file-meta">Member Since</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Page -->
                    <div id="settingsPage" class="dashboard-page">
                        <div class="dashboard-header">
                            <div class="welcome-text">
                                <h1>Settings</h1>
                                <p>Customize your experience</p>
                            </div>
                        </div>

                        <div class="cards-grid">
                            <div class="card col-span-6">
                                <div class="card-header">
                                    <div>
                                        <h3 class="card-title">Profile Settings</h3>
                                        <p class="card-subtitle">Update your information</p>
                                    </div>
                                </div>

                                <form id="settingsForm" style="padding-top: 16px;">
                                    <div class="form-group">
                                        <label class="form-label">Display Name</label>
                                        <input type="text" class="form-input" id="settingsName" style="padding-left: 16px;" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Email (cannot be changed)</label>
                                        <input type="email" class="form-input" id="settingsEmail" style="padding-left: 16px;" disabled>
                                    </div>

                                    <button type="submit" class="btn btn-primary" style="margin-top: 8px;">
                                        <span data-feather="save"></span>
                                        Save Changes
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal-overlay" id="uploadModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Upload Files</h2>
                <button class="modal-close" onclick="closeModal('uploadModal')">
                    <span data-feather="x"></span>
                </button>
            </div>

            <div class="form-group">
                <label class="form-label">Select Folder (Optional)</label>
                <select id="uploadFolder" class="form-input" style="padding-left: 16px;">
                    <option value="">Root (No Folder)</option>
                </select>
            </div>

            <div class="upload-zone" id="uploadZone">
                <div class="upload-zone-icon">
                    <span data-feather="upload-cloud" style="width: 32px; height: 32px;"></span>
                </div>
                <h3 class="upload-zone-title">Drop files here</h3>
                <p class="upload-zone-text">or <span>click to browse</span> (Max 2GB per file)</p>
                <input type="file" id="fileInput" style="display: none;" multiple>
            </div>

            <div id="selectedFiles" style="margin-top: 16px;"></div>

            <button class="btn btn-primary" style="margin-top: 16px;" id="uploadBtn">
                <span data-feather="upload"></span>
                Upload Files
            </button>
        </div>
    </div>

    <!-- Folder Modal -->
    <div class="modal-overlay" id="folderModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Create Folder</h2>
                <button class="modal-close" onclick="closeModal('folderModal')">
                    <span data-feather="x"></span>
                </button>
            </div>

            <form id="folderForm">
                <div class="form-group">
                    <label class="form-label">Folder Name</label>
                    <input type="text" class="form-input" id="folderName" placeholder="Enter folder name" style="padding-left: 16px;" required>
                </div>

                <button type="submit" class="btn btn-primary">
                    <span data-feather="folder-plus"></span>
                    Create Folder
                </button>
            </form>
        </div>
    </div>

    <!-- Upload Progress -->
    <div class="upload-progress-overlay" id="uploadProgress">
        <div class="loading-spinner"></div>
        <div class="upload-progress-info">
            <div class="upload-progress-name" id="uploadFileName">Uploading...</div>
            <div class="upload-progress-bar-container">
                <div class="upload-progress-bar-fill" id="uploadProgressBar"></div>
            </div>
        </div>
        <div class="upload-progress-percent" id="uploadProgressPercent">0%</div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
</body>
</html>
